{"changed":true,"filter":false,"title":"courses_controller.rb","tooltip":"/app/controllers/courses_controller.rb","value":"class CoursesController < ApplicationController\n\n  before_action :student_logged_in, only: [:select, :quit, :list]\n  before_action :teacher_logged_in, only: [:new, :create, :edit, :destroy, :update, :open, :close]#add open by qiao\n  before_action :logged_in, only: :index\n\n  #-------------------------for teachers----------------------\n\n  def new\n    @course=Course.new\n  end\n\n  def create\n    @course = Course.new(course_params)\n    if @course.save\n      current_user.teaching_courses<<@course\n      redirect_to courses_path, flash: {success: \"新课程申请成功\"}\n    else\n      flash[:warning] = \"信息填写有误,请重试\"\n      render 'new'\n    end\n  end\n\n  def edit\n    @course=Course.find_by_id(params[:id])\n  end\n\n  def update\n    @course = Course.find_by_id(params[:id])\n    if @course.update_attributes(course_params)\n      flash={:info => \"更新成功\"}\n    else\n      flash={:warning => \"更新失败\"}\n    end\n    redirect_to courses_path, flash: flash\n  end\n\n  def open\n    @course=Course.find_by_id(params[:id])\n    @course.update_attributes(open: true)\n    redirect_to courses_path, flash: {:success => \"已经成功开启该项目:#{ @course.name}\"}\n  end\n\n  def close\n    @course=Course.find_by_id(params[:id])\n    @course.update_attributes(open: false)\n    redirect_to courses_path, flash: {:success => \"已经成功关闭该项目:#{ @course.name}\"}\n  end\n\n  def destroy\n    @course=Course.find_by_id(params[:id])\n    current_user.teaching_courses.delete(@course)\n    @course.destroy\n    flash={:success => \"成功删除课程: #{@course.name}\"}\n    redirect_to courses_path, flash: flash\n  end\n\n  #-------------------------for students----------------------\n\n  def list\n    #-------QiaoCode--------\n    @courses = Course.where(:open=>true).paginate(page: params[:page], per_page: 4)\n    @course = @courses-current_user.courses\n    tmp=[]\n    @course.each do |course|\n      if course.open==true\n        tmp<<course\n      end\n    end\n    @course=tmp\n  end\n\n  def select\n    @course=Course.find_by_id(params[:id])\n    current_user.courses<<@course\n    flash={:suceess => \"成功选择项目: #{@course.name}\"}\n    redirect_to courses_path, flash: flash\n  end\n\n  def quit\n    @course=Course.find_by_id(params[:id])\n    current_user.courses.delete(@course)\n    flash={:success => \"成功退选课程: #{@course.name}\"}\n    redirect_to courses_path, flash: flash\n  end\n\n\n  #-------------------------for both teachers and students----------------------\n\n  def index\n    @course=current_user.teaching_courses.paginate(page: params[:page], per_page: 4) if teacher_logged_in?\n    @course=current_user.courses.paginate(page: params[:page], per_page: 4) if student_logged_in?\n  end\n\n\n  private\n\n  # Confirms a student logged-in user.\n  def student_logged_in\n    unless student_logged_in?\n      redirect_to root_url, flash: {danger: '请登陆'}\n    end\n  end\n\n  # Confirms a teacher logged-in user.\n  def teacher_logged_in\n    unless teacher_logged_in?\n      redirect_to root_url, flash: {danger: '请登陆'}\n    end\n  end\n\n  # Confirms a  logged-in user.\n  def logged_in\n    unless logged_in?\n      redirect_to root_url, flash: {danger: '请登陆'}\n    end\n  end\n\n  def course_params\n    params.require(:course).permit(:course_code, :name, :course_type, :teaching_type, :exam_type,\n                                   :credit, :limit_num, :class_room, :course_time, :course_week)\n  end\n\n\nend\n","undoManager":{"mark":3,"position":5,"stack":[[{"start":{"row":40,"column":59},"end":{"row":40,"column":60},"action":"remove","lines":["程"],"id":2},{"start":{"row":40,"column":58},"end":{"row":40,"column":59},"action":"remove","lines":["课"]}],[{"start":{"row":40,"column":58},"end":{"row":40,"column":60},"action":"insert","lines":["项目"],"id":10}],[{"start":{"row":46,"column":58},"end":{"row":46,"column":60},"action":"remove","lines":["课程"],"id":11}],[{"start":{"row":46,"column":58},"end":{"row":46,"column":60},"action":"insert","lines":["项目"],"id":19}],[{"start":{"row":75,"column":28},"end":{"row":75,"column":30},"action":"remove","lines":["课程"],"id":20}],[{"start":{"row":75,"column":28},"end":{"row":75,"column":30},"action":"insert","lines":["项目"],"id":28}]]},"ace":{"folds":[],"scrolltop":780,"scrollleft":0,"selection":{"start":{"row":75,"column":34},"end":{"row":75,"column":46},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":20,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1547776482088}